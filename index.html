<!doctype html>
<html>
  <head>
    <title>visual sorting in d3</title>
    <script src="js/d3.v3.min.js"></script>

    <style>
    text {
      font: bold 48px monospace;
    }

    .enter {
      fill: green;
    }

    .update {
      fill: blue;
    }

    .exit {
      fill: red;
    }

    .max{
      fill: blue;
      font-family:sans-serif;
      font-size:20px;
      font-color:black;
    }

    </style>
  </head>
  <body>
    
    <!-- Create the first SVG shape in D3 -->

    

    <script>
      var w_svg = 960;
      var h_svg = 500;
      duration_update = 500


      var svg = d3.select("body")
                  .append("svg")
                  .attr("width", w_svg)
                  .attr("height", h_svg)

      //goal: bubble sort [1,3,4,8,9]
      
      //generate data
      var data_process = [8,1,3,4,9]

      
      function sort_update(data){
          //input a new dataset
          //return an array, so the last element is always the largest
          console.log('data:',data)

          var text = svg.selectAll("text")
                    .data(data,function(d){return d;});

          //update
          text.attr("class", "update")
              .transition()
              .duration(duration_update)
              .attr("x",function(d, i) { return i * 100+100; });

          //enter
          text.enter().append("text")
              .transition()
              .duration(duration_update)
              .attr("class", "enter")
              .text(function(d){return d;})
              .attr("x", function(d, i) { return i * 100+100; })
              .attr("y",200);

          //exit 
          text.exit()
              .attr("class", "exit")
              .transition()
              .duration(duration_update)
              .remove();

        }

          
          //start sorting
          // var sort_data = sort_update(data_start);
          // console.log('sort_data',sort_data)
          var max_num = data_process[0];           
          var i = 1;
          sort_update(data_process);

          setInterval(function() {

            if (max_num < data_process[i]){
                max_num = data_process[i];

                //update highlight max

            }else{
              //swap
                var temp   = data_process[i-1]
                data_process[i-1] = data_process[i]
                data_process[i] = temp

                //update the swap transition, update max position as well

            }
            
            if (i<data_process.length-1) {
              sort_update(data_process);
            }
            i++;

            // var random_pick = Math.floor(100*Math.random())
            // data_process[4] = random_pick
            // console.log('data_process:',data_process)
            // sort_update(shuffle(data_process));

          }, 1000);

          // while(i<data_process.length){
          //   if (max_num < data_process[i]){
          //       max_num = data_process[i];

          //       //update highlight max

          //   }else{
          //     //swap
          //       var temp   = data_process[i-1]
          //       data_process[i-1] = data_process[i]
          //       data_process[i] = temp

          //       //update the swap transition, update max position as well

          //   }
          //   var random_pick = Math.floor(100*Math.random())
          //   data_process[4] = random_pick
          //   console.log('data_process:',data_process)
          //   sort_update(shuffle(data_process));
          //   i++;
          // } 

          //loop
      
      



      //swap
      // var m = 1;
      // var n = 2;
      // var start = 0;
      // text.transition()
      //     .attr("x",function(d,i){
      //       if (i == m){
      //         return n * 100+100
      //       };
      //       if (i == n){
      //         return m * 100+100
      //       };
      //       return i * 100+100; 
      //     });


      //highlight max, start with first one
          // hightlight(4);
          // hightlight(1);

      function hightlight(data, position) {
            circle_radius = 10
            var max_hightlight = svg.selectAll("circle")
                                    .data(data,function(d){return d});
            max_hightlight.enter()
                          .append("circle")
                          .attr("class", "max")
                          .attr("cx", position * 100+100)
                          .attr("cy",150)
                          .attr("r",circle_radius)
                          .style("opacity",function(d, i) { 
                            if (i==position){return 1} return 0});
        }
      
      function shuffle(array) {
        var m = array.length, t, i;
        while (m) {
          i = Math.floor(Math.random() * m--);
          t = array[m], array[m] = array[i], array[i] = t;
        }
        return array;
      }
    </script>
  </body>
</html>